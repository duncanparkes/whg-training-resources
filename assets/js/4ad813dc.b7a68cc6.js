"use strict";(self.webpackChunkwhg_training_resources=self.webpackChunkwhg_training_resources||[]).push([[8379],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),g=p(n),m=r,d=g["".concat(l,".").concat(m)]||g[m]||c[m]||i;return n?a.createElement(d,o(o({ref:t},u),{},{components:n})):a.createElement(d,o({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},3948:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return c}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=["components"],s={sidebar_position:12},l=void 0,p={unversionedId:"programming/programming_with_gene_annotations/Scaling_up",id:"programming/programming_with_gene_annotations/Scaling_up",title:"Scaling_up",description:"Up to table of contents",source:"@site/docs/programming/programming_with_gene_annotations/Scaling_up.md",sourceDirName:"programming/programming_with_gene_annotations",slug:"/programming/programming_with_gene_annotations/Scaling_up",permalink:"/whg-training-resources/programming/programming_with_gene_annotations/Scaling_up",draft:!1,editUrl:"https://github.com/whg-training/whg-training-resources/docs/programming/programming_with_gene_annotations/Scaling_up.md",tags:[],version:"current",sidebarPosition:12,frontMatter:{sidebar_position:12},sidebar:"tutorialSidebar",previous:{title:"How_much_of_the_genome_is_in_genes",permalink:"/whg-training-resources/programming/programming_with_gene_annotations/How_much_of_the_genome_is_in_genes"},next:{title:"Visualisation",permalink:"/whg-training-resources/programming/programming_with_gene_annotations/Visualisation"}},u={},c=[{value:"Scaling up",id:"scaling-up",level:2},{value:"Reducing how much is stored",id:"reducing-how-much-is-stored",level:3},{value:"Not storing it in the first place.",id:"not-storing-it-in-the-first-place",level:3}],g={toc:c};function m(e){var t=e.components,s=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},g,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/"},"Up to table of contents")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Where_next"},"Back to the previous page")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Visualisation"},"Go to the next page")),(0,i.kt)("h2",{id:"scaling-up"},"Scaling up"),(0,i.kt)("p",null,"So far we've written some code and (if you've done what I did) looked at data from a few species.\nThis intriguing but it'd really be great to take a more systematic look across species."),(0,i.kt)("p",null,"For example - maybe you'd like to run it for ",(0,i.kt)("a",{parentName:"p",href:"http://ftp.ensembl.org/pub/current_gff3/"},"all ~300 species with data on\nEnsembl"),"?). "),(0,i.kt)("p",null,"However if you were to do this right now, you would likely run into problems - not least because\nthe output file will grow very large. "),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Challenge")," Make your code ready to apply at scale - say, to hundreds of species."),(0,i.kt)("p",null,"The key problem "),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"}," An aside on python packaging. ")," If all your code is currently in a single file (say ",(0,i.kt)("inlineCode",{parentName:"p"},"gff.py"),"),\nit will be getting quite large - and possibly unwieldy. If so, a good idea is to turn it into a\npython package. This is pretty easy as follows:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"create a new directory ",(0,i.kt)("inlineCode",{parentName:"p"},"gff"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"copy the code in ",(0,i.kt)("inlineCode",{parentName:"p"},"gff.py")," into the new directory. This is a good time to split it up into pieces\nof related code. (For example, I split up the gff parsing code into a file called ",(0,i.kt)("inlineCode",{parentName:"p"},"parse.py"),", the\ncode for reading sequence lengths into a file called ",(0,i.kt)("inlineCode",{parentName:"p"},"sequences.py"),", the code for dealing with\ngenomic regions into ",(0,i.kt)("inlineCode",{parentName:"p"},"regions.py"),", and the code that computes summaries into ",(0,i.kt)("inlineCode",{parentName:"p"},"summary.py"),".)")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create a file called ",(0,i.kt)("inlineCode",{parentName:"p"},"gff/__init__.py"),".  The contents of mine is:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"__all__ = [\n    'parse',\n    'sequences',\n    'summary',\n    'regions'\n]\n\nfrom .parse import *\nfrom .sequences import *\nfrom .summary import *\nfrom .regions import *\n")),(0,i.kt)("p",null,"Congratulations! You have written a python package. "),(0,i.kt)("p",null,"If the above isn't clear, you can see my version of this\n","[",(0,i.kt)("inlineCode",{parentName:"p"},"solutions/part3/gff"),"][solutions/part3/gff/]",". "),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note.")," With the ",(0,i.kt)("inlineCode",{parentName:"p"},"__init__.py")," written as above, the package can still be used in the same way as\nbefore (i.e. by writing ",(0,i.kt)("inlineCode",{parentName:"p"},"import gff"),"). The key benefit of a package is that it lets you split code\nup into smaller files, which I find makes it easier to edit and add to. It also provides you a\nplace to put tests (add a ",(0,i.kt)("inlineCode",{parentName:"p"},"tests/")," folder), and allows you more control over how the code is\naccessed (by altering ",(0,i.kt)("inlineCode",{parentName:"p"},"__init__.py"),".)"),(0,i.kt)("h3",{id:"reducing-how-much-is-stored"},"Reducing how much is stored"),(0,i.kt)("p",null,"The current code essentially reconstructs a database of the input data - storing all the records.\nIf you did this for 300 species it would rapidly get very large indeed. Of course - you might want\na reconstructed database, which is after all a useful thing. But for most purposes it is probably\nbetter if we can reduce the amount of storage used - and also the amount of computation that needs\nto be done."),(0,i.kt)("p",null,"What improvements can we make to this? Here are some thoughts."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Our analysis so far only using the genes, transcripts, exons and CDS records. There's no point\nstoring anything else.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Many of the identifiers have redundant stuff in - for example ",(0,i.kt)("inlineCode",{parentName:"p"},"gene:")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"transcript:")," prefixes.\nEditing the identifiers to remove these prefixes would save quite a bit of space.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The attributes column uses up a lot of space.  Maybe we can just storing attributes for the gene\nrecords?"))),(0,i.kt)("p",null,"The above suggests one way to go. Storing only the records we need - and removing most of the\nattributes columns - indeed reduces the size of the database (I found by about a third)."),(0,i.kt)("h3",{id:"not-storing-it-in-the-first-place"},"Not storing it in the first place."),(0,i.kt)("p",null,"Of course if we really want to save space, we would avoid storing all that data for transcripts,\nexons etc. at all. Why don't we run our analysis on the gene data as we load it, and then only\nstore the gene-leve summaries we have computed?"),(0,i.kt)("p",null,"You can see ",(0,i.kt)("a",{target:"_blank",href:n(6494).Z},"my quick attempt at that here"),". If you run it,\ninstead of the original ",(0,i.kt)("inlineCode",{parentName:"p"},"gff_data"),", you get:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"a ",(0,i.kt)("inlineCode",{parentName:"p"},"genes")," table which just lists the gene records, but with the number of transcripts and mean number of\nexons have been added as extra columns.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"a ",(0,i.kt)("inlineCode",{parentName:"p"},"sequences")," table that lists the sequences extracted from the file.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"a ",(0,i.kt)("inlineCode",{parentName:"p"},"gene_statistics")," table which lists our ",(0,i.kt)("a",{parentName:"p",href:"Counting_genes2.md"},"gene count statistics"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"a ",(0,i.kt)("inlineCode",{parentName:"p"},"coverage_statistics")," table which lists our ",(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/How_much_of_the_genome_is_in_genes"},"genome coverage statistics")))),(0,i.kt)("p",null,"Importantly (unless you specify an option) the code does not store all the transcripts, exons, or\ncoding sequence records, and consequently the output file is much smaller. But it still allows us\nto explore interesting genes."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note.")," To make this easy to write I wrapped up much of our analysis code into a new ",(0,i.kt)("a",{parentName:"p",href:"https://docs.python.org/3/tutorial/classes.html"},"python\nclass")," - which you can find here:\n",(0,i.kt)("a",{target:"_blank",href:n(1192).Z},(0,i.kt)("code",null,"solutions/scaling_up/gff/analysis.py")),". Encapsulating\nthings into a class like this is useful, because we have several related data objects and the class\nkeeps them all in one place, and makes sure they are used appropriately. However, this class is\narguably not very well written and it fails on some of the ",(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Introduction"},"original criteria")," I\nsuggested - not least that it would be hard to test. So really this class should be split up\nfurther."),(0,i.kt)("p",null,"The next page has some ",(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Visualisation"},"tips on visualisation"),"."))}m.isMDXComponent=!0},1192:function(e,t,n){t.Z=n.p+"assets/files/analysis-0a5049a720829f5befc5a6781ccbb1ac.py"},6494:function(e,t,n){t.Z=n.p+"assets/files/summarise_gff3-3b6ab300c74c51665eed5db98f299b9a.py"}}]);