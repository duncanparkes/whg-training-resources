"use strict";(self.webpackChunkwhg_training_resources=self.webpackChunkwhg_training_resources||[]).push([[6325],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=c(n),m=o,h=p["".concat(s,".").concat(m)]||p[m]||u[m]||r;return n?a.createElement(h,i(i({ref:t},d),{},{components:n})):a.createElement(h,i({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2624:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return u}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],l={},s=void 0,c={unversionedId:"statistical_modelling/Introduction/practicals/o_bld_grp/O_bld_group_genome_wide_comparison",id:"statistical_modelling/Introduction/practicals/o_bld_grp/O_bld_group_genome_wide_comparison",title:"O_bld_group_genome_wide_comparison",description:"Calibration / model checking for the O blood group finding",source:"@site/docs/statistical_modelling/Introduction/practicals/o_bld_grp/O_bld_group_genome_wide_comparison.md",sourceDirName:"statistical_modelling/Introduction/practicals/o_bld_grp",slug:"/statistical_modelling/Introduction/practicals/o_bld_grp/O_bld_group_genome_wide_comparison",permalink:"/whg-training-resources/statistical_modelling/Introduction/practicals/o_bld_grp/O_bld_group_genome_wide_comparison",draft:!1,editUrl:"https://github.com/whg-training/whg-training-resources/docs/statistical_modelling/Introduction/practicals/o_bld_grp/O_bld_group_genome_wide_comparison.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"When asymptotics go wrong",permalink:"/whg-training-resources/statistical_modelling/Introduction/practicals/malaria_exposure/When asymptotics go wrong"},next:{title:"distributions warmup",permalink:"/whg-training-resources/statistical_modelling/Introduction/practicals/warmup/distributions warmup"}},d={},u=[{value:"Calibration / model checking for the O blood group finding",id:"calibration--model-checking-for-the-o-blood-group-finding",level:2},{value:"Aside",id:"aside",level:2},{value:"Summary",id:"summary",level:2}],p={toc:u};function m(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"calibration--model-checking-for-the-o-blood-group-finding"},"Calibration / model checking for the O blood group finding"),(0,r.kt)("p",null,"In class we analysed this table:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"                      non-O blood group    O blood group\ncontrols              3420                 3233\nsevere malaria cases  3925                 2738\n")),(0,r.kt)("p",null,"which can be created in R as:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'data = matrix(\n    c(\n        3420, 3233,\n        3925, 2738\n    ),\n    ncol = 2,\n    byrow = T,\n    dimnames = list(\n        c( "controls", "cases" ),\n        c( "non-O", "O" )\n    )\n)\n')),(0,r.kt)("p",null,"The odds ratio computed from this table is 0.74 - suggesting O blood group is protective.  And a test of this table using ",(0,r.kt)("inlineCode",{parentName:"p"},"chisq.test()")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"fisher.test()")," shows that this is highly statistically significant.  That means:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"If")," the data were truly sampled from a binomial distribution with given frequency in each row"),(0,r.kt)("li",{parentName:"ul"},"and ",(0,r.kt)("em",{parentName:"li"},"if")," the true odds ratio was zero"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"then")," a table with such a large odds ratio would almost never occur.")),(0,r.kt)("p",null,"These are approximations which don't really hold.  Samples are not really independent (e.g. population structure is itself a reflection of distant relationships); frequencies might vary across populations; in a finite population it's not really credible that the true effect size is really zero (though it might be very close)."),(0,r.kt)("p",null,"We would therefore like to verify that there isn't something going on we haven't thought of.  I.e. is our null model really sensible?"),(0,r.kt)("p",null,"One of the advantages of genome-wide analysis is that we have a lot of data to answer this with.\nSuppose we compare our finding with all other 'similar' variants in the genome.  They have all been\ngenotyped on the same set of samples.  So they represent the same sampling biases (if any) and the same demography.  However, due to recombination they also represent many independent draws from the genealogical history of the sample."),(0,r.kt)("p",null,"The file ",(0,r.kt)("inlineCode",{parentName:"p"},"recessive_counts_matching_O_frequency.csv.gz")," contains data for all the alleles in our\nstudy that match the frequency of the O blood group mutation."),(0,r.kt)("p",null,"Load it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'X = read.csv(\n    "recessive_counts_matching_O_frequency.csv.gz",\n    header = T,      # Tell R our file has a row of column names\n    as.is = T,       # Ask R to please not transmogrify any data\n    check.names = F  # Also ask R not to mess around with column names \n)\n')),(0,r.kt)("p",null,"Let's first sanity check I've computed frequencies right.  It's often best to first collect numerical data into a matrix - this is a container of numbers that is layed out nicely in memory for computation.  (Unlike a data frame which holds columns of data of different types).  The ",(0,r.kt)("inlineCode",{parentName:"p"},"as.matrix()")," function does this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'data = as.matrix( X[, c( "controls:A", "controls:B", "cases:A", "cases:B" )])\n# look at the data\nhead( data )\n\nX$frequency = (data[,2] + data[,4]) / rowSums(data)\n\n# plot it\nhist(\n    X$frequency,\n    breaks = 5, #\xa0how many bars across the plot?\n    xlab = "Recessive dosage frequency",\n    xlim = c( 0.3, 0.7 ) \n)\nabline( v = X$frequency[ which( X$rsid == \'rs8176719\' )], col = \'red\' )\n')),(0,r.kt)("p",null,"Compute the log-odds ratio for every variant:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"X$logOR = log( (data[,1] * data[,4]) / ( data[,2] * data[,3]) )\n")),(0,r.kt)("p",null,"Let's look at the distribution of log odds ratios:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"hist(\n    X$logOR,\n    breaks = 50,\n    xlab = \"log Odds ratio\",\n    main = \"Alleles matching O blood group frequency\",\n    xlim = c( -0.5, 0.5 ),\n    xaxt = 'n'  # Turn off the axis so we can draw our own\n)\nticks = c( 0.5, 0.6, 0.7, 0.8, 0.9, 1, 1.1, 1.2, 1.3 )\naxis(\n    1,       # on the bottom edge\n    at = log(ticks),\n    label = ticks\n)\n\n# Let's put an arrow where O blood group allele is:\narrows(\n    x0 = X$logOR[ which( X$rsid == 'rs8176719' )],\n    x1 = X$logOR[ which( X$rsid == 'rs8176719' )],\n    y0 = 2000, y1 = 100,\n    length = 0.1,\n    col = 'red'\n)\ntext(\n    x = X$logOR[ which( X$rsid == 'rs8176719' )], y = 2000,\n    pos = 3, # draw text above\n    label = \"O bld grp.\",\n    col = 'red'\n)\n")),(0,r.kt)("p",null,"Compute the standard error of the log OR (using the standard formula):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# for table\n#   a b\n#   c d\n# the formula is sqrt( 1/a + 1/b + 1/c + 1/d )\nX$SE = sqrt( rowSums( 1/data ))\n")),(0,r.kt)("p",null,'Is the null model at all plausible here?  The null model says that all variation in the effect size (the log OR) is due to sampling variation.  It should be distributed as a N(0, SE^2).  (all the stnadard errors will be similar here because of the choice of variant).  To test how well the null model fits, we can plot standard-error-adjusted effect sizes ("Z-scores") against a gaussian distribution:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"region = c( -5, 5 )\nhist(\n    X$logOR / X$SE,\n    breaks = 100,\n    xlab = \"x score\",\n    xlim = region,\n    ylim = c( 0, 0.5 ),\n    main = \"Alleles matching O blood group frequency\",\n    freq = FALSE #\xa0plot y axis values as a density, for comparison\n)\nx = seq( from = region[1], to = region[2], by = 0.01 )\npoints(\n    x,\n    dnorm( x, mean = 0, sd = 1 ),\n    type = 'l',\n    col = 'red'\n)\n")),(0,r.kt)("p",null,"It's not a bad fit!  There's a small gap at the top and slightly fatter tail to the real data.\nA more sensitive plot is a quantile-quantile plot, where we plot ordered statistics against their expection.  We can do that here:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"zscores = sort( X$logOR / X$SE )\nexpected = qnorm( (1:length(zscores))/(length(zscores)+1)) # Normal distribution quantiles\nplot(\n    expected,\n    zscores,\n    pch = 19 # nice round dots\n)\nabline( a = 0, b = 1, col = 'red' )\ngrid()\n")),(0,r.kt)("p",null,"The distribution definitely has fatter tails than expected."),(0,r.kt)("h2",{id:"aside"},"Aside"),(0,r.kt)("p",null,"(A: I've the qq plot in terms of z-scores, because I like thinking in 'effect size' space.  A more often seen qq-plot is based on a p-value as follows.  A traditional (Wald test) P-value compares\nthe z-score with the standard gaussian, as in our plot above:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"X$pvalue = pnorm( -abs(X$logOR), sd = X$SE ) * 2\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Note"),": the ",(0,r.kt)("inlineCode",{parentName:"p"},"abs()")," and multiplying by two in the above are needed to capture both the left and right tail of the distribution.  We'd be interested in effects going in either direction.  (You could equally well use the squared z-score and ",(0,r.kt)("inlineCode",{parentName:"p"},"pchisq"),".)  We can make a qq-plot by plotting p-values against ranked expected quantiles:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'pvalues = -log10( sort( X$pvalue ) )\nexpected = -log10( (1:length(pvalues)  / (length(pvalues)+1)))\nplot(\n    expected,\n    xlab = "Expected log10 P-value",\n    pvalues,\n    ylab = "Observed log10 P-value",\n    pch = 19, # nice round dots\n    xlim = c( 0, 20 ), # make it square\n    ylim = c( 0, 20 )  # make it square\n)\nabline( a = 0, b = 1, lty = 2 )\n\n# Let\'s highlight O blood group on the plkot:\nw = which( pvalues == -log10( X$pvalue[ X$rsid == \'rs8176719\' ]))\npoints(\n    expected[w],\n    pvalues[w],\n    col = \'red\'\n)\ntext(\n    expected[w],\n    pvalues[w],\n    pos = 2,             # put it to left\n    adj = 1,             # right-justify\n    label = "O bld grp"\n)\n')),(0,r.kt)("p",null,"Challenge: the kth point in this plot is -log10 of a kth order statistic.  Use this fact to add vertical error bars for each point?"),(0,r.kt)("h2",{id:"summary"},"Summary"),(0,r.kt)("p",null,"We have shown"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"That O blood has an estimated protective effect in these data."),(0,r.kt)("li",{parentName:"ol"},"That such a large estimated effect is unlikely ",(0,r.kt)("em",{parentName:"li"},"under the formal model assumptions")," if the effect were really zero (hence the small P-value)."),(0,r.kt)("li",{parentName:"ol"},"That other similar variants genome-wide do seem fairly compatible with the model of no effect.  This gives us confidence that our P-value (computed against the null) reflects something realistic. In particular, there isn't some large systematic problem with our use of the P-value that would invalidate our analysis."),(0,r.kt)("li",{parentName:"ol"},"However, genome-wide variants don't seem 100% compatible with the model assumptions.")),(0,r.kt)("p",null,"Note that:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"point 1 is purely about our statistical model and the data we have observed"),(0,r.kt)("li",{parentName:"ul"},"point 2 is a comparison of our data with a ",(0,r.kt)("em",{parentName:"li"},"hypothetical infinite set of unobserved data")," generated under the model assumptions."),(0,r.kt)("li",{parentName:"ul"},"point 3 is a comparison of our data with other real data generated in the same samples."),(0,r.kt)("li",{parentName:"ul"},"point 4 suggests there is still further calibration to perform.")),(0,r.kt)("p",null,"Of course we also know that the O blood group mutation (rs8176719) is a deletion of protein-coding sequence that alters red cell surface antigens, making us a priori likely to think this might be involved (compared to, say, a randomly chosen genetic variant)."),(0,r.kt)("p",null,"What could we do re: point 4?  Are there actually many variants across the genome having nontrivial true effect on malaria susceptibility?  Or is there some systematic confounding going on?  (This seems not impossible, due to the diverse set of samples data was drawn from.)"))}m.isMDXComponent=!0}}]);