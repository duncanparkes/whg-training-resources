"use strict";(self.webpackChunkwhg_training_resources=self.webpackChunkwhg_training_resources||[]).push([[5049],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return h}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),g=l(n),h=o,c=g["".concat(p,".").concat(h)]||g[h]||u[h]||r;return n?a.createElement(c,i(i({ref:t},m),{},{components:n})):a.createElement(c,i({ref:t},m))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=g;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},3110:function(e,t,n){n.r(t),n.d(t,{assets:function(){return m},contentTitle:function(){return p},default:function(){return h},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return u}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],s={sidebar_position:6},p="Gathering some first statistics",l={unversionedId:"programming/programming_with_gene_annotations/Counting_genes_1",id:"programming/programming_with_gene_annotations/Counting_genes_1",title:"Gathering some first statistics",description:"Up to table of contents",source:"@site/docs/programming/programming_with_gene_annotations/Counting_genes_1.md",sourceDirName:"programming/programming_with_gene_annotations",slug:"/programming/programming_with_gene_annotations/Counting_genes_1",permalink:"/whg-training-resources/programming/programming_with_gene_annotations/Counting_genes_1",draft:!1,editUrl:"https://github.com/whg-training/whg-training-resources/docs/programming/programming_with_gene_annotations/Counting_genes_1.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Converting_gff_to_sqlite",permalink:"/whg-training-resources/programming/programming_with_gene_annotations/Converting_gff_to_sqlite"},next:{title:"Memory_issues_and_how_to_solve_them",permalink:"/whg-training-resources/programming/programming_with_gene_annotations/Memory_issues_and_how_to_solve_them"}},m={},u=[{value:"How many genes are there?",id:"how-many-genes-are-there",level:3},{value:"What are all these species?",id:"what-are-all-these-species",level:3},{value:"What kinds of gene are there?",id:"what-kinds-of-gene-are-there",level:3}],g={toc:u};function h(e){var t=e.components,s=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},g,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"gathering-some-first-statistics"},"Gathering some first statistics"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/"},"Up to table of contents")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Converting_gff_to_sqlite"},"Back to the previous page")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Memory_issues_and_how_to_solve_them"},"Go to the next page")),(0,r.kt)("p",null,"Let's start to attack our scientific questions. From simplicty, from here on in we will work with the GFF3 files\nfrom the ",(0,r.kt)("a",{parentName:"p",href:"http://ftp.ensembl.org/pub/current_gff3/"},"Ensembl ftp site")," - also those from\n",(0,r.kt)("a",{parentName:"p",href:"https://plasmodb.org/plasmo/app/downloads/Current_Release/"},"PlasmoDB"),". These use the terminology ",(0,r.kt)("inlineCode",{parentName:"p"},"mRNA")," for a gene\ntranscript, and they also have the genome sequence lengths written in the metadata, making life easy for us."),(0,r.kt)("p",null,"We will focus on protein-coding genes, and their transcripts, exons and coding sequence. They have\ntype ",(0,r.kt)("inlineCode",{parentName:"p"},"gene"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"mRNA"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"exon")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"CDS")," in the files respectively. They come in a basic hierarchy:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Each gene can have multiple transcripts (i.e. multiple expressed forms at mRNA level - e.g. they\nmight differ in how exons are spliced together, or have different transcription start or end\nsites).")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Each transcript is made up of one or more exons. The introns in between are spliced out. (This\nhappens during the transcription process.)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Of the exon sequence that makes it into a transcript, only a portion is actually translated into\nthe mature protein during processing by the ribosomes. This is the ",(0,r.kt)("em",{parentName:"p"},"coding sequence")," and the rest\nis ",(0,r.kt)("em",{parentName:"p"},"untranslated sequence"),"."))),(0,r.kt)("p",null,"The files we're looking are (roughly speaking) humanities' best guess at what this picture looks\nlike in each organism."),(0,r.kt)("p",null,"We're actually in a good shape for many of ",(0,r.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Introduction"},"our scientific questions"),". Let's start\nby counting genes:"),(0,r.kt)("h3",{id:"how-many-genes-are-there"},"How many genes are there?"),(0,r.kt)("p",null,"Let's start with counting genes - easy! One way is to use sqlite. For example using the sqlite file\nyou created in the last step:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sqlite> SELECT COUNT(*) FROM gff_data WHERE type==`gene` ;\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Note.")," I ran the above command interactively in sqlite3 - you get there by typing ",(0,r.kt)("inlineCode",{parentName:"p"},"sqlite3 genes.sqlite")," in the shell.\nType ",(0,r.kt)("inlineCode",{parentName:"p"},".quit")," to quit.)"),(0,r.kt)("p",null,"If you followed the suggestions, or used my version of the code, your file will also have an ",(0,r.kt)("inlineCode",{parentName:"p"},"analysis")," column that\nlets you differentiate species.  So you can make these counts for multiple species:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sqlite> .mode column\nsqlite> .header on\nsqlite> SELECT analysis, COUNT(*) FROM gff_data WHERE type=='gene' GROUP BY analysis ;\n")),(0,r.kt)("p",null,"Which gives:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"analysis                                     COUNT(*)  \n-------------------------------------------  ----------\nAcanthochromis_polyacanthus.ASM210954v1.104  24027     \nCamelus_dromedarius.CamDro2.104.chr.gff3     18919     \nGallus_gallus.GRCg6a.104                     16666     \nHomo_sapiens.GRCh38.104                      21451     \nMus_musculus.GRCm39.104                      25655     \nPan_troglodytes.Pan_tro_3.0.104.chr          22056     \nPlasmoDB-54_Pfalciparum3D7                   5318      \n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Note:")," To make the above query work the ",(0,r.kt)("a",{parentName:"p",href:"https://plasmodb.org/plasmo/app/downloads/Current_Release/"},(0,r.kt)("em",{parentName:"a"},"P.falciparum")," data from\nPlasmoDB"),", I kludged it by running this sql:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"UPDATE genes\nSET type = 'gene', biotype = 'protein_coding_gene'\nWHERE analysis == 'PlasmoDB-54_Pfalciparum3D7'\nAND type == 'protein_coding_gene' ;\n")),(0,r.kt)("p",null,"Though I wouldn't generally recommend this type of manually-fix-the-data-until-it-works approach\n(not least because it would have to be re-done every time we imported new data) it'll do for this tutorial."),(0,r.kt)("p",null,"You can also do this type of thing pretty easily in python.  For example, importing the GFF file directly:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},">>> import gff\n>>> data = gff.parse_gff3_to_dataframe(\"Homo_sapiens.GRCh38.104.chr.gff3\" ) # assuming you have downloaded this file\n>>> data[ data['type'] == 'gene' ].shape\n(21451, 11)\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note.")," When I do this the process is using up 1Gb of memory (as reported by ",(0,r.kt)("inlineCode",{parentName:"p"},"top"),"). In fact only\nMicrosoft Word is using more! That workds ok on my laptop (which has 16Gb of RAM) but we wouldn't\nhave to add much more data to make things fall over. In real analyses you may have to pay special\nattention to writing memory-efficient code. We'll come back to these issues, and how to solve them\n",(0,r.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Memory_issues_and_how_to_solve_them"},"later in the tutorial"),". In the meantime - if you're\nrunning out of memory and can't even make the database, you could try ",(0,r.kt)("a",{parentName:"p",href:"solutions/low_memory/"},"this low-memory version of\n",(0,r.kt)("inlineCode",{parentName:"a"},"gff_to_sqlite.py")),"."),(0,r.kt)("p",null,"If we wanted to carry out the same query as we did above, across multiple species, using python\ncode, the simplest way is to load the data directly from the database - and then use ",(0,r.kt)("a",{parentName:"p",href:"https://pandas.pydata.org/docs/user_guide/groupby.html"},"the pandas\n",(0,r.kt)("inlineCode",{parentName:"a"},".groupby()")," operation"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'import pandas, sqlite3\ndb = sqlite3.connect( "genes.sqlite" )\ngenes = pandas.read_sql( "SELECT * FROM gff_data WHERE type == \'gene\'", db )\ngenes.groupby( "analysis" ).size()\n')),(0,r.kt)("p",null,"This produces:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"analysis\nAcanthochromis_polyacanthus.ASM210954v1.104    24027\nCamelus_dromedarius.CamDro2.104.chr.gff3       18919\nGallus_gallus.GRCg6a.104                       16666\nHomo_sapiens.GRCh38.104                        21451\nMus_musculus.GRCm39.104                        25655\nPan_troglodytes.Pan_tro_3.0.104.chr            22056\nPlasmoDB-54_Pfalciparum3D7                      5318\ndtype: int64\n")),(0,r.kt)("p",null,"Interestingly, both ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/House_mouse"},"house mice")," and ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Spiny_chromis"},"spiny\nchromis")," have more (annotated) genes than humans.\nChimpanzees have a similar number, while ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Red_junglefowl"},"Red\njunglefowl")," and ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Dromedary"},"Dromedary\nCamels")," have respectively 17% and 5% fewer (annotated)\nprotein-coding genes than humans. ",(0,r.kt)("em",{parentName:"p"},"Plasmodium falciparum")," has about a quarter of the number of\ngenes. (But that's still pretty impressive because its genome size is less than a hundredth that of\nhumans.)"),(0,r.kt)("h3",{id:"what-are-all-these-species"},"What are all these species?"),(0,r.kt)("p",null,"If you're wondering that - it's time to look at ",(0,r.kt)("a",{parentName:"p",href:"http://www.onezoom.org"},"OneZoom.org"),". For example,\nthis reminded me of the slightly amazing fact that Dolphins, like Camels, are ",(0,r.kt)("a",{parentName:"p",href:"http://www.onezoom.org/life/@Cetartiodactyla=622916"},"cloven-hoofed\nungulates"),"."),(0,r.kt)("h3",{id:"what-kinds-of-gene-are-there"},"What kinds of gene are there?"),(0,r.kt)("p",null,'The above counts all "genes".  But what exactly are these?'),(0,r.kt)("p",null,"One way to figure this out is by looking at what they are ",(0,r.kt)("em",{parentName:"p"},"not"),". You can find all the top-level\nrecord types (those with no ",(0,r.kt)("inlineCode",{parentName:"p"},"Parent"),") in the file like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'import pandas, sqlite3\ndb = sqlite3.connect( "genes.sqlite" )\ntypes = pandas.read_sql( "SELECT analysis, type, COUNT(*) FROM gff_data WHERE Parent IS NULL GROUP BY analysis, type", db )\nprint( types )\n')),(0,r.kt)("p",null,"All the species have ",(0,r.kt)("inlineCode",{parentName:"p"},"pseudogenes")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"non-coding RNAs")," as well as genes."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Question:")," What are pseudogenes and non-coding RNAs anyway? Look them up on ",(0,r.kt)("a",{parentName:"p",href:"http://www.sequenceontology.org/so_wiki/index.php/Category:SO:SOFA"},"the sequence\nontology"),". Here is ",(0,r.kt)("a",{parentName:"p",href:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3491395/"},"an\ninteresting reference on pseudogenes")," and on\n",(0,r.kt)("a",{parentName:"p",href:"https://www.frontiersin.org/articles/10.3389/fgene.2015.00002/full"},"non-coding RNAs"),"."),(0,r.kt)("p",null,"(The file also have ",(0,r.kt)("inlineCode",{parentName:"p"},"region")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"biological_region")," records - my guess is these are computational\npredictions of regions with biological function - e.g. transcript start sites from\n",(0,r.kt)("a",{parentName:"p",href:"https://www.sanger.ac.uk/tool/eponine/"},"Eponine"),".)"),(0,r.kt)("p",null,"What sets apart ",(0,r.kt)("em",{parentName:"p"},"genes")," from ",(0,r.kt)("em",{parentName:"p"},"pseudogenes")," and ",(0,r.kt)("em",{parentName:"p"},"non-coding RNAs")," is that they code for proteins.\nHowever, it's not quite that simple. If you look more closely at the records with ",(0,r.kt)("inlineCode",{parentName:"p"},"type=gene"),",\nyou'll see they actually have a second ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," field - it is called ",(0,r.kt)("inlineCode",{parentName:"p"},"biotype")," and is buried in the\nattributes. This ",(0,r.kt)("inlineCode",{parentName:"p"},"biotype")," tells us some extra information about the gene. To let us look at this\nwe need to update the code."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Challenge:")," Update your ",(0,r.kt)("inlineCode",{parentName:"p"},"gff.py")," code to make it easy to get this information out - i.e. by\nadding it as an extra column.  (It would also useful to extract the ",(0,r.kt)("inlineCode",{parentName:"p"},"Name"),", which contains gene names.)"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Hints:")," "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"You already extracted ",(0,r.kt)("inlineCode",{parentName:"p"},"ID")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Parent")," into dedicated columns - it ought to be easy to get\nother attributes as well?")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"If making changes feels difficult or impossible in your code - I suggest you might want to ",(0,r.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Refactoring_makes_code_better"},"try a\nrefactor")," first. That is, make changes to your code to make it\nsimpler without changing its behaviour. If you have ",(0,r.kt)("a",{target:"_blank",href:n(9930).Z},"tests")," then you\ncan make changes quite safely because the tests will ensure (to some extent at least) that it\nstill works correctly. Once the code feels nice and simple, it will be much easier to see how to\nmake changes.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Extra challenge"),": Wouldn't it be good if we could remove the attributes we've put into columns\n(",(0,r.kt)("inlineCode",{parentName:"p"},"ID"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Parent"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Name")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"biotype")," say) from the ",(0,r.kt)("inlineCode",{parentName:"p"},"attributes")," column as well?"))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"More hints:")," My solution is in ",(0,r.kt)("a",{parentName:"p",href:"solutions/part2/"},(0,r.kt)("inlineCode",{parentName:"a"},"solutions/part2"))," if you want to take a look.\nBecause of the earlier refactor, I only had to change one line of ",(0,r.kt)("inlineCode",{parentName:"p"},"parse_gff3_to_dataframe()"),". I\nthen implemented a new function ",(0,r.kt)("inlineCode",{parentName:"p"},"extract_attributes_to_columns()")," instead of the original\n",(0,r.kt)("inlineCode",{parentName:"p"},"add_ID_and_Parent()"),"."),(0,r.kt)("p",null,"Now let's talk more about ",(0,r.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Counting_genes_2"},"Investigating protein-coding genes"),"."))}h.isMDXComponent=!0},9930:function(e,t,n){t.Z=n.p+"assets/files/test_gff-526a50c301ebdf96eabe45cc8c29765c.py"}}]);