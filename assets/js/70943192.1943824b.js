"use strict";(self.webpackChunkwhg_training_resources=self.webpackChunkwhg_training_resources||[]).push([[7547],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return f}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=p(n),f=a,g=m["".concat(l,".").concat(f)]||m[f]||c[f]||o;return n?r.createElement(g,i(i({ref:t},u),{},{components:n})):r.createElement(g,i({ref:t},u))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1174:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return f},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return c}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],s={sidebar_position:4},l=void 0,p={unversionedId:"programming/programming_with_gene_annotations/Refactoring_makes_code_better",id:"programming/programming_with_gene_annotations/Refactoring_makes_code_better",title:"Refactoring_makes_code_better",description:"Up to table of contents",source:"@site/docs/programming/programming_with_gene_annotations/Refactoring_makes_code_better.md",sourceDirName:"programming/programming_with_gene_annotations",slug:"/programming/programming_with_gene_annotations/Refactoring_makes_code_better",permalink:"/whg-training-resources/programming/programming_with_gene_annotations/Refactoring_makes_code_better",draft:!1,editUrl:"https://github.com/whg-training/whg-training-resources/docs/programming/programming_with_gene_annotations/Refactoring_makes_code_better.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Processing GFF files",permalink:"/whg-training-resources/programming/programming_with_gene_annotations/Getting_started_writing_some_code"},next:{title:"Converting_gff_to_sqlite",permalink:"/whg-training-resources/programming/programming_with_gene_annotations/Converting_gff_to_sqlite"}},u={},c=[{value:"Refactoring makes code better",id:"refactoring-makes-code-better",level:2}],m={toc:c};function f(e){var t=e.components,s=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},m,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/"},"Up to table of contents")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Converting_gff_to_sqlite"},"Back to the previous page")),(0,o.kt)("h2",{id:"refactoring-makes-code-better"},"Refactoring makes code better"),(0,o.kt)("p",null,"How much do you like the code you wrote in ",(0,o.kt)("inlineCode",{parentName:"p"},"gff.py"),"?"),(0,o.kt)("p",null,"Personally, I don't like ",(0,o.kt)("a",{target:"_blank",href:n(7962).Z},"my original version")," very much! Shorn of comments it\nlooks like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"def parse_gff3_to_dataframe( file ):\n    \"\"\"Read GFF3-formatted data in the specified file (or file-like object)\n    Return a pandas dataframe with ID, Parent, seqid, source, type, start, end, score, strand, phase, and attributes columns.\n    The ID and Parent are extracted from the attributes columns, and the dataframe is indexed by ID\"\"\"\n\n    def getID( attributes ):\n        return parse_attributes( attributes ).get( 'ID', None )\n    def getParent( attributes ):\n        return parse_attributes( attributes ).get( 'Parent', None )\n    result = _read_gff3_using_pandas( file )\n    result['ID'] = result['attributes'].apply( getID )\n    result['Parent'] = result['attributes'].apply( getParent )\n    result = result[ ['ID', 'Parent', 'seqid', 'source', 'type', 'start', 'end', 'score', 'strand', 'phase', 'attributes'] ]\n    return result\n")),(0,o.kt)("p",null,"It's just... ",(0,o.kt)("em",{parentName:"p"},"complicated"),"."),(0,o.kt)("p",null,"The function should be simple.  It only does three things:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Loads the data"),(0,o.kt)("li",{parentName:"ol"},"Extract the ",(0,o.kt)("inlineCode",{parentName:"li"},"ID")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"Parent")," fields from the ",(0,o.kt)("inlineCode",{parentName:"li"},"attributes")," column"),(0,o.kt)("li",{parentName:"ol"},"Returns it.")),(0,o.kt)("p",null,"So that is how we should write it:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"def parse_gff3_to_dataframe( file ):\n    result = read_gff3_using_pandas( file )\n    add_ID_and_Parent( result )\n    return result\n")),(0,o.kt)("p",null,"That's more like it! This new version of the function is much shorter and simpler, and it's easy to understand. A good\nsign is that (unlike the first version) it doesn't really need any comments because it's more or less obvious what it\ndoes just from the function names."),(0,o.kt)("p",null,"Of course we have to write the ",(0,o.kt)("inlineCode",{parentName:"p"},"add_ID_and_Parent()")," function, but ",(0,o.kt)("a",{target:"_blank",href:n(2343).Z},"that's not hard"),". In the\nprocess of writing this I realised that the ",(0,o.kt)("a",{parentName:"p",href:"https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.insert.html"},"pandas ",(0,o.kt)("inlineCode",{parentName:"a"},".insert()"),"\nmethod")," can be used to put the columns in at\nthe start - so the last line of the original version (that reorders columns) isn't needed any more."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"add_ID_and_Parent()")," function follows a different pattern from the other functions we have written: it ",(0,o.kt)("em",{parentName:"p"},"mutates\nits first argument"),".  "),(0,o.kt)("p",null,"Written this way, both the main function and the bits used for implementation are easy to test. Here is a ","[test using\npython's unit test module]","( (solutions/part1/test_gff.py) to show you what I mean."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note.")," If you run the tests, you'll see that in fact my ",(0,o.kt)("inlineCode",{parentName:"p"},"parse_attributes()")," function has a potential bug if it\nencounters a badly-formatted attributes value that contains an equals sign in the value itself. Does this type of input\nappear in the wild? Probably. (The ",(0,o.kt)("a",{parentName:"p",href:"https://docs.python.org/3/library/stdtypes.html"},(0,o.kt)("inlineCode",{parentName:"a"},"partition()"))," function could be\nused to fix this.)"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Challenge.")," Refactor your code. Can you make it easy to understand?"),(0,o.kt)("p",null,"Now ",(0,o.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Getting_started_writing_some_code"},"go back to the section on writing code"),"."))}f.isMDXComponent=!0},2343:function(e,t,n){t.Z=n.p+"assets/files/gff-9caed837b4ef044cc415f0a851eff819.py"},7962:function(e,t,n){t.Z=n.p+"assets/files/gff_first_version-f9b8b73915b2712648ba982c8ad27505.py"}}]);